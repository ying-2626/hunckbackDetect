<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SittingWatch - æ™ºèƒ½åå§¿ç›‘æµ‹ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="../css/login.css">
</head>

<body>
    <div class="background-shapes">
        <div class="shape shape-1"></div>
        <div class="shape shape-2"></div>
    </div>

    <div class="container">
        <!-- å·¦ä¾§ä»‹ç»åŒºåŸŸ -->
        <div class="left-panel">
            <h1 class="app-title">SittingWatch</h1>
            <p class="app-subtitle">å®æ—¶åå§¿ç›‘æµ‹ï¼Œå®ˆæŠ¤æ‚¨çš„å¥åº·å§¿åŠ¿</p>

            <div class="features">
                <div class="feature">
                    <i class="fas fa-video">ğŸ“·</i>
                    <div class="feature-text">
                        <h3>å®æ—¶å§¿æ€åˆ†æ</h3>
                        <p>é€šè¿‡æ‘„åƒå¤´å®æ—¶æ£€æµ‹åå§¿é—®é¢˜</p>
                    </div>
                </div>

                <div class="feature">
                    <i class="fas fa-bell">ğŸ””</i>
                    <div class="feature-text">
                        <h3>æ™ºèƒ½æé†’ç³»ç»Ÿ</h3>
                        <p>å‘ç°ä¸è‰¯å§¿åŠ¿ç«‹å³æé†’</p>
                    </div>
                </div>

                <div class="feature">
                    <i class="fas fa-chart-line">ğŸ“Š</i>
                    <div class="feature-text">
                        <h3>å¥åº·æ•°æ®æŠ¥å‘Š</h3>
                        <p>æ¯æ—¥ã€æ¯å‘¨åå§¿åˆ†ææŠ¥å‘Š</p>
                    </div>
                </div>

                <div class="feature">
                    <i class="fas fa-user-friends">ğŸ’»</i>
                    <div class="feature-text">
                        <h3>å¤šè®¾å¤‡æ”¯æŒ</h3>
                        <p>ç”µè„‘ã€å¹³æ¿ã€æ‰‹æœºå¤šå¹³å°ä½¿ç”¨</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- å³ä¾§è¡¨å•åŒºåŸŸ -->
        <div class="right-panel">
            <div class="form-container">
                <div class="form-header" id="form-header">
                    <h2>æ¬¢è¿ä½¿ç”¨SittingWatch</h2>
                </div>

                <div class="tabs">
                    <div class="tab active" data-tab="login">ç™»å½•è´¦æˆ·</div>
                    <div class="tab" data-tab="register">æ³¨å†Œè´¦æˆ·</div>
                </div>

                <!-- ç™»å½•è¡¨å• -->
                <form class="form active" id="login-form">
                    <div class="form-group">
                        <label for="login-email">ç”µå­é‚®ç®±</label>
                        <div class="input-with-icon">
                            <i class="fas fa-envelope"></i>
                            <input type="email" class="form-control" id="login-email" placeholder="è¯·è¾“å…¥æ‚¨çš„é‚®ç®±" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="login-password">å¯†ç </label>
                        <div class="input-with-icon">
                            <i class="fas fa-lock"></i>
                            <input type="password" class="form-control" id="login-password" placeholder="è¯·è¾“å…¥å¯†ç "
                                required>
                            <i class="fas fa-eye password-toggle"></i>
                        </div>
                    </div>

                    <div class="options">
                        <div class="remember">
                            <input type="checkbox" id="remember-me">
                            <label for="remember-me">è®°ä½æˆ‘</label>
                        </div>
                        <a href="#" class="forgot-password">å¿˜è®°å¯†ç ?</a>
                    </div>

                    <button type="submit" class="btn btn-primary">ç™»å½•</button>


                    <p class="signup-link">è¿˜æ²¡æœ‰è´¦æˆ·? <a href="#" id="go-to-register">ç«‹å³æ³¨å†Œ</a></p>
                </form>

                <!-- æ³¨å†Œè¡¨å• -->
                <form class="form" id="register-form">
                    <div class="form-group">
                        <label for="register-name">ç”¨æˆ·å</label>
                        <div class="input-with-icon">
                            <i class="fas fa-user"></i>
                            <input type="text" class="form-control" id="register-name" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="register-email">ç”µå­é‚®ç®±</label>
                        <div class="input-with-icon">
                            <i class="fas fa-envelope"></i>
                            <input type="email" class="form-control" id="register-email" placeholder="è¯·è¾“å…¥é‚®ç®±" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="register-password">å¯†ç </label>
                        <div class="input-with-icon">
                            <i class="fas fa-lock"></i>
                            <input type="password" class="form-control" id="register-password" placeholder="è®¾ç½®å¯†ç  (è‡³å°‘8ä½)"
                                required>
                            <i class="fas fa-eye password-toggle"></i>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="register-confirm">ç¡®è®¤å¯†ç </label>
                        <div class="input-with-icon">
                            <i class="fas fa-lock"></i>
                            <input type="password" class="form-control" id="register-confirm" placeholder="ç¡®è®¤æ‚¨çš„å¯†ç "
                                required>
                            <i class="fas fa-eye password-toggle"></i>
                        </div>
                    </div>



                    <button type="submit" class="btn btn-primary">åˆ›å»ºè´¦æˆ·</button>

                    <p class="signup-link">å·²æœ‰è´¦æˆ·? <a href="#" id="go-to-login">ç«‹å³ç™»å½•</a></p>
                </form>
            </div>
        </div>
    </div>

    <script>
        // æ ‡ç­¾åˆ‡æ¢åŠŸèƒ½
        const tabs = document.querySelectorAll('.tab');
        const forms = document.querySelectorAll('.form');
        const formHeader = document.getElementById('form-header');

        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                // ç§»é™¤æ‰€æœ‰æ ‡ç­¾å’Œè¡¨activeç±»
                tabs.forEach(t => t.classList.remove('active'));
                forms.forEach(f => f.classList.remove('active'));

                // ä¸ºå½“å‰æ ‡ç­¾æ·»åŠ activeç±»
                tab.classList.add('active');

                // æ˜¾ç¤ºå¯¹åº”è¡¨å•
                const tabType = tab.getAttribute('data-tab');
                document.getElementById(`${tabType}-form`).classList.add('active');

                // åˆ‡æ¢åˆ°æ³¨å†Œæ—¶éšè—æ¬¢è¿æ ‡é¢˜ï¼Œåˆ‡æ¢åˆ°ç™»å½•æ—¶æ˜¾ç¤º
                if (tabType === 'register') {
                    formHeader.style.display = 'none';
                } else {
                    formHeader.style.display = 'block';
                }
            });
        });

        // ç™»å½•/æ³¨å†Œåˆ‡æ¢é“¾æ¥
        document.getElementById('go-to-register').addEventListener('click', (e) => {
            e.preventDefault();
            tabs.forEach(t => t.classList.remove('active'));
            forms.forEach(f => f.classList.remove('active'));

            document.querySelector('.tab[data-tab="register"]').classList.add('active');
            document.getElementById('register-form').classList.add('active');
            // éšè—æ¬¢è¿æ ‡é¢˜
            formHeader.style.display = 'none';
        });

        document.getElementById('go-to-login').addEventListener('click', (e) => {
            e.preventDefault();
            tabs.forEach(t => t.classList.remove('active'));
            forms.forEach(f => f.classList.remove('active'));

            document.querySelector('.tab[data-tab="login"]').classList.add('active');
            document.getElementById('login-form').classList.add('active');
            // æ˜¾ç¤ºæ¬¢è¿æ ‡é¢˜
            formHeader.style.display = 'block';
        });

        // å¯†ç æ˜¾ç¤º/éšè—åŠŸèƒ½
        const passwordToggles = document.querySelectorAll('.password-toggle');

        passwordToggles.forEach(toggle => {
            toggle.addEventListener('click', () => {
                const input = toggle.previousElementSibling;
                const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
                input.setAttribute('type', type);

                toggle.classList.toggle('fa-eye');
                toggle.classList.toggle('fa-eye-slash');
            });
        });

        // ç™»å½•è¡¨å•æäº¤å¤„ç†
        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value;
            const msg = document.createElement('div');
            msg.style.textAlign = 'center';
            msg.style.margin = '10px 0';
            msg.style.color = '#f44336';

            // ç§»é™¤æ—§æç¤º
            const oldMsg = document.getElementById('login-msg');
            if (oldMsg) oldMsg.remove();
            msg.id = 'login-msg';

            try {
                // ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œé€‚é… Vercel éƒ¨ç½²
                const resp = await fetch('/api/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                // å…ˆæ£€æŸ¥HTTPçŠ¶æ€ç 
                if (!resp.ok) {
                    const errorData = await resp.json();
                    throw new Error(errorData.error || 'ç™»å½•å¤±è´¥');
                }

                const data = await resp.json();
                localStorage.setItem('user_email', data.email);
                window.location.href = 'index.html';
            } catch (err) {
                msg.textContent = 'ç™»å½•é”™è¯¯ï¼Œè¯·é‡è¯•';
                document.getElementById('login-form').prepend(msg);
            }
        });

        // æ³¨å†Œè¡¨å•æäº¤å¤„ç†
        document.getElementById('register-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('register-name').value.trim();
            const email = document.getElementById('register-email').value.trim();
            const password = document.getElementById('register-password').value;
            const confirm = document.getElementById('register-confirm').value;
            const msg = document.createElement('div');
            msg.style.textAlign = 'center';
            msg.style.margin = '10px 0';
            msg.style.color = '#f44336';

            // ç§»é™¤æ—§æç¤º
            const oldMsg = document.getElementById('register-msg');
            if (oldMsg) oldMsg.remove();
            msg.id = 'register-msg';

            if (password !== confirm) {
                msg.textContent = 'ä¸¤æ¬¡å¯†ç ä¸ä¸€è‡´';
                document.getElementById('register-form').prepend(msg);
                return;
            }

            try {
                // ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œé€‚é… Vercel éƒ¨ç½²
                const resp = await fetch('/api/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, email, password })
                });
                const data = await resp.json();
                if (!resp.ok) {
                    msg.textContent = data.error || 'æ³¨å†Œå¤±è´¥';
                    document.getElementById('register-form').prepend(msg);
                    return;
                }
                localStorage.setItem('user_email', data.email);
                window.location.href = 'index.html';
            } catch (err) {
                msg.textContent = 'æ³¨å†Œé”™è¯¯ï¼Œè¯·é‡è¯•';
                document.getElementById('register-form').prepend(msg);
            }
        });
    </script>
</body>

</html>